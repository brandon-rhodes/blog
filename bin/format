#!/usr/bin/env python

import datetime
import sys
from bottle import SimpleTemplate

rst_overrides = {'initial_header_level': 2}

if __name__ == '__main__':
    in_path, out_path = sys.argv[1:]

    with open(in_path) as f:
        dict_text = f.read()

    info = eval(dict_text, {'datetime': datetime})
    in_html = info['body']
    in_html += u'\n% rebase layout {}\n'.format(', '.join(
        '{}={}'.format(name, repr(value)) for name, value in dict(
            add_disqus=info.get('add_disqus', False),
            add_mathjax=info.get('add_mathjax', False),
            date=info.get('info'),  # huh?
            previous_link=False,
            next_link=False,
            tags=info.get('tags'),
            title=info['title'],
        ).items()))

    tpl = SimpleTemplate(in_html, lookup=['templates'])
    out_html = tpl.render()
    open(out_path, 'w').write(out_html.encode('utf-8'))
